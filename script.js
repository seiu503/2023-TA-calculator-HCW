const lookup = [
  {
    "userHours": 1,
    "eocHourly": 20,
    "locTotalNoContract": 1775.84,
    "locTotal": 1914.49,
    "increaseOverCurrent": 138.65,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 2,
    "eocHourly": 20,
    "locTotalNoContract": 3551.69,
    "locTotal": 3828.99,
    "increaseOverCurrent": 277.3,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 3,
    "eocHourly": 20,
    "locTotalNoContract": 5327.53,
    "locTotal": 5743.48,
    "increaseOverCurrent": 415.95,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 4,
    "eocHourly": 20,
    "locTotalNoContract": 7103.38,
    "locTotal": 7657.98,
    "increaseOverCurrent": 554.6,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 5,
    "eocHourly": 20,
    "locTotalNoContract": 8879.22,
    "locTotal": 9572.47,
    "increaseOverCurrent": 693.24,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 6,
    "eocHourly": 20,
    "locTotalNoContract": 10655.07,
    "locTotal": 11486.96,
    "increaseOverCurrent": 831.89,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 7,
    "eocHourly": 20,
    "locTotalNoContract": 12430.91,
    "locTotal": 13401.46,
    "increaseOverCurrent": 970.54,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 8,
    "eocHourly": 20,
    "locTotalNoContract": 14206.76,
    "locTotal": 15315.95,
    "increaseOverCurrent": 1109.19,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 9,
    "eocHourly": 20,
    "locTotalNoContract": 15982.6,
    "locTotal": 17230.45,
    "increaseOverCurrent": 1247.84,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 10,
    "eocHourly": 20,
    "locTotalNoContract": 17758.45,
    "locTotal": 19144.94,
    "increaseOverCurrent": 1386.49,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 11,
    "eocHourly": 20,
    "locTotalNoContract": 19534.29,
    "locTotal": 21059.43,
    "increaseOverCurrent": 1525.14,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 12,
    "eocHourly": 20,
    "locTotalNoContract": 21310.14,
    "locTotal": 22973.93,
    "increaseOverCurrent": 1663.79,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 13,
    "eocHourly": 20,
    "locTotalNoContract": 23085.98,
    "locTotal": 24888.42,
    "increaseOverCurrent": 1802.44,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 14,
    "eocHourly": 20,
    "locTotalNoContract": 24861.83,
    "locTotal": 26802.91,
    "increaseOverCurrent": 1941.09,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 15,
    "eocHourly": 20,
    "locTotalNoContract": 26637.67,
    "locTotal": 28717.41,
    "increaseOverCurrent": 2079.73,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 16,
    "eocHourly": 20,
    "locTotalNoContract": 28413.52,
    "locTotal": 30631.9,
    "increaseOverCurrent": 2218.38,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 17,
    "eocHourly": 20,
    "locTotalNoContract": 30189.36,
    "locTotal": 32546.4,
    "increaseOverCurrent": 2357.03,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 18,
    "eocHourly": 20,
    "locTotalNoContract": 31965.21,
    "locTotal": 34460.89,
    "increaseOverCurrent": 2495.68,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 19,
    "eocHourly": 20,
    "locTotalNoContract": 33741.05,
    "locTotal": 36375.38,
    "increaseOverCurrent": 2634.33,
    "numCOLAs": 2,
    "numSteps": 0
  },
  {
    "userHours": 20,
    "eocHourly": 21,
    "locTotalNoContract": 35516.9,
    "locTotal": 39245.78,
    "increaseOverCurrent": 3728.88,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 21,
    "eocHourly": 21,
    "locTotalNoContract": 37292.74,
    "locTotal": 41208.07,
    "increaseOverCurrent": 3915.32,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 22,
    "eocHourly": 21,
    "locTotalNoContract": 39068.59,
    "locTotal": 43170.36,
    "increaseOverCurrent": 4101.77,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 23,
    "eocHourly": 21,
    "locTotalNoContract": 40844.43,
    "locTotal": 45132.64,
    "increaseOverCurrent": 4288.21,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 24,
    "eocHourly": 21,
    "locTotalNoContract": 42620.28,
    "locTotal": 47094.93,
    "increaseOverCurrent": 4474.65,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 25,
    "eocHourly": 21,
    "locTotalNoContract": 44396.12,
    "locTotal": 49057.22,
    "increaseOverCurrent": 4661.1,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 26,
    "eocHourly": 21,
    "locTotalNoContract": 46171.97,
    "locTotal": 51019.51,
    "increaseOverCurrent": 4847.54,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 27,
    "eocHourly": 21,
    "locTotalNoContract": 47947.81,
    "locTotal": 52981.8,
    "increaseOverCurrent": 5033.99,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 28,
    "eocHourly": 21,
    "locTotalNoContract": 49723.66,
    "locTotal": 54944.09,
    "increaseOverCurrent": 5220.43,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 29,
    "eocHourly": 21,
    "locTotalNoContract": 51499.5,
    "locTotal": 56906.38,
    "increaseOverCurrent": 5406.87,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 30,
    "eocHourly": 21,
    "locTotalNoContract": 53275.35,
    "locTotal": 58868.67,
    "increaseOverCurrent": 5593.32,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 31,
    "eocHourly": 21,
    "locTotalNoContract": 55051.19,
    "locTotal": 60830.96,
    "increaseOverCurrent": 5779.76,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 32,
    "eocHourly": 21,
    "locTotalNoContract": 56827.04,
    "locTotal": 62793.24,
    "increaseOverCurrent": 5966.21,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 33,
    "eocHourly": 21,
    "locTotalNoContract": 58602.88,
    "locTotal": 64755.53,
    "increaseOverCurrent": 6152.65,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 34,
    "eocHourly": 21,
    "locTotalNoContract": 60378.73,
    "locTotal": 66717.82,
    "increaseOverCurrent": 6339.09,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 35,
    "eocHourly": 21,
    "locTotalNoContract": 62154.57,
    "locTotal": 68680.11,
    "increaseOverCurrent": 6525.54,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 36,
    "eocHourly": 21,
    "locTotalNoContract": 63930.42,
    "locTotal": 70642.4,
    "increaseOverCurrent": 6711.98,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 37,
    "eocHourly": 21,
    "locTotalNoContract": 65706.26,
    "locTotal": 72604.69,
    "increaseOverCurrent": 6898.43,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 38,
    "eocHourly": 21,
    "locTotalNoContract": 67482.11,
    "locTotal": 74566.98,
    "increaseOverCurrent": 7084.87,
    "numCOLAs": 2,
    "numSteps": 1
  },
  {
    "userHours": 39,
    "eocHourly": 22,
    "locTotalNoContract": 69257.95,
    "locTotal": 78393.27,
    "increaseOverCurrent": 9135.32,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 40,
    "eocHourly": 22,
    "locTotalNoContract": 71033.8,
    "locTotal": 80403.36,
    "increaseOverCurrent": 9369.56,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 41,
    "eocHourly": 22,
    "locTotalNoContract": 73697.57,
    "locTotal": 83418.48,
    "increaseOverCurrent": 9720.92,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 42,
    "eocHourly": 22,
    "locTotalNoContract": 76361.33,
    "locTotal": 86433.61,
    "increaseOverCurrent": 10072.27,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 43,
    "eocHourly": 22,
    "locTotalNoContract": 79025.1,
    "locTotal": 89448.73,
    "increaseOverCurrent": 10423.63,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 44,
    "eocHourly": 22,
    "locTotalNoContract": 81688.87,
    "locTotal": 92463.86,
    "increaseOverCurrent": 10774.99,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 45,
    "eocHourly": 22,
    "locTotalNoContract": 84352.64,
    "locTotal": 95478.99,
    "increaseOverCurrent": 11126.35,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 46,
    "eocHourly": 22,
    "locTotalNoContract": 87016.4,
    "locTotal": 98494.11,
    "increaseOverCurrent": 11477.71,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 47,
    "eocHourly": 22,
    "locTotalNoContract": 89680.17,
    "locTotal": 101509.24,
    "increaseOverCurrent": 11829.07,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 48,
    "eocHourly": 22,
    "locTotalNoContract": 92343.94,
    "locTotal": 104524.36,
    "increaseOverCurrent": 12180.43,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 49,
    "eocHourly": 22,
    "locTotalNoContract": 95007.7,
    "locTotal": 107539.49,
    "increaseOverCurrent": 12531.78,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 50,
    "eocHourly": 22,
    "locTotalNoContract": 97671.47,
    "locTotal": 110554.61,
    "increaseOverCurrent": 12883.14,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 51,
    "eocHourly": 22,
    "locTotalNoContract": 100335.24,
    "locTotal": 113569.74,
    "increaseOverCurrent": 13234.5,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 52,
    "eocHourly": 22,
    "locTotalNoContract": 102999.01,
    "locTotal": 116584.87,
    "increaseOverCurrent": 13585.86,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 53,
    "eocHourly": 22,
    "locTotalNoContract": 105662.77,
    "locTotal": 119599.99,
    "increaseOverCurrent": 13937.22,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 54,
    "eocHourly": 22,
    "locTotalNoContract": 108326.54,
    "locTotal": 122615.12,
    "increaseOverCurrent": 14288.58,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 55,
    "eocHourly": 22,
    "locTotalNoContract": 110990.31,
    "locTotal": 125630.24,
    "increaseOverCurrent": 14639.93,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 56,
    "eocHourly": 22,
    "locTotalNoContract": 113654.08,
    "locTotal": 128645.37,
    "increaseOverCurrent": 14991.29,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 57,
    "eocHourly": 22,
    "locTotalNoContract": 116317.84,
    "locTotal": 131660.5,
    "increaseOverCurrent": 15342.65,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 58,
    "eocHourly": 22,
    "locTotalNoContract": 118981.61,
    "locTotal": 134675.62,
    "increaseOverCurrent": 15694.01,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 59,
    "eocHourly": 22,
    "locTotalNoContract": 121645.38,
    "locTotal": 137690.75,
    "increaseOverCurrent": 16045.37,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 60,
    "eocHourly": 22,
    "locTotalNoContract": 124309.15,
    "locTotal": 140705.87,
    "increaseOverCurrent": 16396.73,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 61,
    "eocHourly": 22,
    "locTotalNoContract": 126972.91,
    "locTotal": 143721,
    "increaseOverCurrent": 16748.08,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 62,
    "eocHourly": 22,
    "locTotalNoContract": 129636.68,
    "locTotal": 146736.12,
    "increaseOverCurrent": 17099.44,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 63,
    "eocHourly": 22,
    "locTotalNoContract": 132300.45,
    "locTotal": 149751.25,
    "increaseOverCurrent": 17450.8,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 64,
    "eocHourly": 22,
    "locTotalNoContract": 134964.22,
    "locTotal": 152766.38,
    "increaseOverCurrent": 17802.16,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 65,
    "eocHourly": 22,
    "locTotalNoContract": 137627.98,
    "locTotal": 155781.5,
    "increaseOverCurrent": 18153.52,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 66,
    "eocHourly": 22,
    "locTotalNoContract": 140291.75,
    "locTotal": 158796.63,
    "increaseOverCurrent": 18504.88,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 67,
    "eocHourly": 22,
    "locTotalNoContract": 142955.52,
    "locTotal": 161811.75,
    "increaseOverCurrent": 18856.24,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 68,
    "eocHourly": 22,
    "locTotalNoContract": 145619.29,
    "locTotal": 164826.88,
    "increaseOverCurrent": 19207.59,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 69,
    "eocHourly": 22,
    "locTotalNoContract": 148283.05,
    "locTotal": 167842.01,
    "increaseOverCurrent": 19558.95,
    "numCOLAs": 2,
    "numSteps": 2
  },
  {
    "userHours": 70,
    "eocHourly": 22,
    "locTotalNoContract": 150946.82,
    "locTotal": 170857.13,
    "increaseOverCurrent": 19910.31,
    "numCOLAs": 2,
    "numSteps": 2
  }
];

// set global variables
let userHours = 0;
let userProjHours = 0;
let numberOfCOLAs = 0;
let numberOfSteps = 0;
let endHourlyRate = 0;
let payIncreaseDollar = 0;
let payIncreasePercent = 0;
let lifeOfContractTotal = 0;
let userLang = "en-US";
let userLangCode = "en";
let userObj = {};
let projUserObj = {};
let hpwElIsTouched = false;
let hpwProjElIsTouched = false;

// translation object
const trans = {
  p1_1: {
    en: "You will be eligible for ",
    es: "Usted será elegible para ",
    ru: "Вы будете иметь право на ",
    vi: "Bạn sẽ đủ điều kiện nhận ",
    zh: "合同结束时，您将有资格获得 "
  },
  p1_2: {
    en: " COLAs (Cost of Living Adjustments) and up to ",
    es: " ajustes por costo de vida (COLA, siglas en inglés) a su salario y hasta ",
    ru: " COLA (корректировки стоимости жизни) и до ",
    vi: " COLA (Điều chỉnh chi phí sinh hoạt) và tăng lên tới ", 
    zh: " COLA（生活费用调整）和直到 "
  },
  p1_2_noStep: {
    en: " COLAs (Cost of Living Adjustments).",
    es: " ajustes por costo de vida (COLA, siglas en inglés) a su salario.",
    ru: " COLA (корректировка стоимости жизни).",
    vi: " COLA (Điều chỉnh chi phí sinh hoạt).", 
    zh: " COLA（生活费用调整）。"
  },
  p1_3: {
    en: " step increases by the end of the contract.",
    es: " aumentos por escalafón al vencimiento del contrato colectivo.",
    ru: " поступенчатых повышений зарплаты к концу действия контракта. ",
    vi: " bậc khi kết thúc hợp đồng.", 
    zh: " 步加薪。"
  },
  p2_1: {
    en: "Your hourly rate by the end of the 2023-2025 contract will be ",
    es: "Su pago por hora al final del contrato 2023-2025 será ",
    ru: "Ваша почасовая ставка к концу контракта на 2023-2025 годы составит ",
    vi: "Mức lương theo giờ của bạn vào cuối hợp đồng 2023-2025 sẽ là ", 
    zh: "到 2023-2025 年合同结束时，您的时薪将为 "
  },
  p2_2: {
    en: " for hours up to 40 per week, and ",
    es: " para horas hasta 40 por semana, y ",
    ru: " долларов США за часы до 40 в неделю и ",
    vi: " cho số giờ làm việc lên tới 40 mỗi tuần và ", 
    zh: " 美元，所有加班时间为 "
  },
  p2_3: {
    en: " for all overtime hours (up to 20 overtime hours per week).",
    es: " para todas las horas extras/'overtime' (hasta 20 horas extras por semana).",
    ru: " долларов США за все сверхурочные часы (до 20 часов сверхурочной работы в неделю).",
    vi: " cho tất cả số giờ làm thêm (tối đa 20 giờ làm thêm mỗi tuần).", 
    zh: " 美元（每周加班时间不超过 20 小时）。"
  },
  p3_1: {
    en: "This pay increase is ",
    es: "Este aumento salarial es ",
    ru: "Это увеличение заработной платы на ",
    vi: "Mức tăng lương này là ",
    zh: "此次加薪比当前 17.77 美元的基本工资高 "
  },
  p3_2: {
    en: " more per hour than the current base rate of $17.77. This is a ",
    es: " más por hora que la tarifa base actual de $17.77. Este es un aumento del ",
    ru: " больше в час, чем текущая базовая ставка в размере 17,77 долл. Это ",
    vi: " nhiều hơn mỗi giờ so với mức lương cơ bản hiện tại là 17,77 USD. Đây là mức tăng ",
    zh: " 倍。到合同结束时，每小时增加 "
  },
  p3_3: {
    en: " percent increase per hour by the end of the contract.",
    es: " por ciento por hora al vencimiento del contrato colectivo.",
    ru: "-процентное увеличение в час к концу действия контракта.",
    vi: " phần trăm mỗi giờ vào cuối hợp đồng.",
    zh: "%。"
  },
  p4_1: {
    en: "Your increase in earnings over the life of the contract is estimated to be ",
    es: "Su aumento estimado en los ingresos durante el plazo del acuerdo de negociación colectiva: ",
    ru: "Ваше увеличение заработка в течение срока действия контракта оценивается в ",
    vi: "Mức tăng thu nhập của bạn trong suốt thời hạn hợp đồng được ước tính là ",
    zh: "在合同期内，您的收入预计将增加 "
  },
  valHPW: {
    en: "Please enter a whole number between 1 and 140.",
    es: "Por favor ingresa un número entero entre 1 y 140.",
    ru: "Пожалуйста, введите целое число от 1 до 140.",
    vi: "Vui lòng nhập một số nguyên từ 1 đến 140.",
    zh: "请输入 1 到 140 之间的整数."
  },
  valHPWProj: {
    en: "Please enter a whole number between 1 and 140.",
    es: "Por favor ingresa un número entero entre 1 y 140.",
    ru: "Пожалуйста, введите целое число от 1 до 140.",
    vi: "Vui lòng nhập một số nguyên từ 1 đến 140.",
    zh: "请输入 1 到 140 之间的整数."
  }
}

document.addEventListener("DOMContentLoaded", function(){
  console.log('dom loaded');

  // save elements to variables for later access
  let displayEl = document.getElementById("display");
  let dispwrap = document.getElementById("dispwrap");
  let form = document.getElementById("inputForm");
  let submit = document.getElementById("submitButton");
  let startOver = document.getElementById("startOverButton");
  let results = document.getElementById("results");
  let message = document.getElementById('message');
  let hpwEl = document.getElementById("hPW");
  let hpwProjEl = document.getElementById("hPWProj");
  let hPWValEl = document.getElementById('hPWVal');
  let hPWProjValEl = document.getElementById('hPWProjVal');
  let instructions = document.getElementById("instructions");
  let inputs = document.getElementById("inputs");
  let languagePicker = document.getElementsByClassName('gt_selector')[0];

  // reset form on page reload
  form.reset();

  // set language code
  const setLanguageCode = () => {
    if (languagePicker) {
      console.log(`languagePicker: ${languagePicker.value}`);
      userLang = languagePicker.value;
      userLangCode = userLang.substring(3).toLowerCase();
      console.log(`userLang LP: ${userLang}`);
      console.log(`userLangCode LP: ${userLangCode}`);
    } else {
      userLang = navigator.language || navigator.userLanguage; 
      userLangCode = userLang.substring(0,2).toLowerCase();
      console.log(`userLang NOLP: ${userLang}`);
      console.log(`userLangCode NOLP: ${userLangCode}`);
    }

    const langCodeOptions = ['en', 'es', 'ru', 'vi', 'zh'];

    // default to english if user language is not supported
    if (!langCodeOptions.includes(userLangCode)) {
      console.log('userLangCode not in array');
      userLangCode = "en";
      console.log(`userLangCode: ${userLangCode}`);
    };
  }
  setLanguageCode();

  // find userObj
  const findUserObj = () => {
    console.log('findUserObj');
    console.log(`userHours: ${userHours}`);
    userObj = lookup.find((item) => item['userHours'].toString() === userHours );
    if (!userObj) { userObj = {} };
    console.log('userObj');
    console.log(userObj);
  };

  const findProjUserObj = () => {
    console.log('findProjUserObj');
    console.log(`userProjHours: ${userProjHours}`);
    projUserObj = lookup.find((item) => item['userHours'].toString() === userProjHours );
    if (!projUserObj) { projUserObj = {} };
    console.log('projUserObj');
    console.log(projUserObj);
  }

  // listen for changes to hours worked
  function hoursChange(e) {
    console.log('hoursChange');
    userHours = e.target.value;
    console.log(`userHours: ${userHours}`);
    findUserObj();
  }

  // listen for changes to projected hours worked
  function projHoursChange(e) {
    console.log('projHoursChange');
    userProjHours = e.target.value;
    console.log(`userProjHours: ${userProjHours}`);
    findProjUserObj();
  }

  // clean currency strings
  const clean = (str) => {
    if (typeof(str) == "number") {
      return str;
    } else {
      return parseFloat(str.replace(/[^0-9]/g, ""));
    }
  };

  // generate results string and message
  function resultsString() {
    // set variables
    let numCOLAs = projUserObj['numCOLAs'] || 0;
    let numSteps = projUserObj['numSteps'] || 0;
    let eocHourly = projUserObj['eocHourly'] || 0;
    let eocHourlyOvertime = (eocHourly * 1.5).toLocaleString(undefined, { maximumFractionDigits: 2, minimumFractionDigits: 2 }) || 0;
    let payIncreaseDollar = eocHourly - 17.77 || 0;
    let payIncreasePercent = (payIncreaseDollar / 17.77 * 100).toFixed(0) || 0;
    let locTotalNoContract = userObj['locTotalNoContract'] || 0;
    let locProjTotal = projUserObj['locTotal'] || 0;
    let increaseOverLOC = locProjTotal - locTotalNoContract || 0;
    let noSteps = numSteps == '0' || numSteps == 0;
    let stepsString = '';

    console.log(`numCOLAs: ${numCOLAs}`);
    console.log(`numSteps: ${numSteps}`);
    console.log(`noSteps: ${noSteps}`);
    console.log(`eocHourly: ${eocHourly}`);
    console.log(`eocHourlyOvertime: ${eocHourlyOvertime}`);
    console.log(`payIncreaseDollar: ${payIncreaseDollar}`);
    console.log(`payIncreasePercent: ${payIncreasePercent}`);
    console.log(`locTotalNoContract: ${locTotalNoContract}`);
    console.log(`increaseOverLOC: ${increaseOverLOC}`);
    console.log(`$${increaseOverLOC
                      .toLocaleString(
                        undefined, 
                          { 
                            maximumFractionDigits: 2, 
                            minimumFractionDigits: 2 
                          }
                        )
                      }`)

    if (noSteps) {
      stepsString = trans['p1_2_noStep'][userLangCode];
    } else {
      stepsString = `${trans['p1_2'][userLangCode]}<span class="purplebold">${numSteps}</span>${trans['p1_3'][userLangCode]}`;
    }

    return `<p style="max-width: 600px; margin: auto auto 20px auto;">
              <ul style="max-width: 600px; margin: auto;">
                <li style="margin-bottom:15px;">
                  ${trans['p1_1'][userLangCode]}
                  <span class="purplebold">${numCOLAs}</span>
                  ${stepsString}
                </li>
                <li style="margin-bottom:15px;">
                  ${trans['p2_1'][userLangCode]}
                  <span class="purplebold">$${eocHourly}</span>
                  ${trans['p2_2'][userLangCode]}
                  <span class="purplebold">$${eocHourlyOvertime}</span>
                  ${trans['p2_3'][userLangCode]}
                </li>
                <li style="margin-bottom:15px;">
                  ${trans['p3_1'][userLangCode]}
                  <span class="purplebold">
                    $${payIncreaseDollar
                      .toLocaleString(
                        undefined, 
                          { 
                            maximumFractionDigits: 2, 
                            minimumFractionDigits: 2 
                          }
                        )
                      }
                  </span>
                  ${trans['p3_2'][userLangCode]}
                  <span class="purplebold">${payIncreasePercent}</span>
                  ${trans['p3_3'][userLangCode]}
                </li>
                <li style="margin-bottom:15px;">
                  ${trans['p4_1'][userLangCode]}
                  <span class="purplebold">
                    $${increaseOverLOC
                      .toLocaleString(
                        undefined, 
                          { 
                            maximumFractionDigits: 2, 
                            minimumFractionDigits: 2 
                          }
                        )
                      }</span>.
                </li>
              </ul>
            </p>`
  }

  // On reload, reload page
  function handleReload() {
    form.reset(); 
    window.location.reload();
  }

  function validateHPW() {
    console.log('validateHPW');
    var reg = /^\d+$/;
    if (!userHours || userHours < 1 || userHours > 140 || !reg.test(userHours) ) {
      console.log('hpwInvalid');
      hpwEl.classList.add("invalid");
      hPWValEl.setAttribute("style", "display:block;");
      hPWValEl.innerHTML = `${trans['valHPW'][userLangCode]}`;
      submit.setAttribute("disabled", "disabled");
      startOver.setAttribute("style", "display:block;");
      return false;
    } else {
      console.log('hpwValid');
      hpwEl.classList.remove("invalid");
      hPWValEl.innerHTML = "";
      hPWValEl.setAttribute("style", "display:none;");
      submit.removeAttribute("disabled");
      startOver.setAttribute("style", "display:none;");
      return true;
    }
  }

  function validateProjHPW() {
    console.log('validateHPWProj');
    var reg = /^\d+$/;
    if (!userProjHours || userProjHours < 1 || userProjHours > 140 || !reg.test(userProjHours) ) {
      console.log('hpwProjInvalid');
      hpwProjEl.classList.add("invalid");
      hPWProjValEl.setAttribute("style", "display:block;");
      hPWProjValEl.innerHTML = `${trans['valHPWProj'][userLangCode]}`;
      submit.setAttribute("disabled", "disabled");
      return false;
    } else {
      console.log('hpwValid');
      hpwProjEl.classList.remove("invalid");
      hPWProjValEl.innerHTML = "";
      hPWProjValEl.setAttribute("style", "display:none;");
      submit.removeAttribute("disabled");
      return true;
    }
  }

  // On submit, validate inputs. if valid, hide instructions and display results
  function handleSubmit(e) {
    e.preventDefault();
    let valid;
    valid = validateHPW();
    valid = validateProjHPW();
    console.log(valid);
    if (valid) {
      console.log('valid', valid);
      submit.setAttribute("style", "display:none;");
      startOver.setAttribute("style", "display:block;");
      instructions.setAttribute("style", "height: 0; display:none;");
      inputs.setAttribute("style", "height: 0; display:none;");
      message.setAttribute("style", "display:block;");
      results.innerHTML = resultsString();
    }
  }

  submit.addEventListener("click", handleSubmit);
  startOver.addEventListener("click", handleReload);
  hpwEl.addEventListener("change", hoursChange);
  hpwEl.addEventListener("blur", validateHPW);
  hpwProjEl.addEventListener("change", projHoursChange);
  hpwProjEl.addEventListener("blur", validateProjHPW);
  if(languagePicker) {
    languagePicker.addEventListener("change", setLanguageCode);
  }

});
